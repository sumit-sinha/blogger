!function(){var t={},e=function(e){for(var n=t[e],i=n.deps,r=n.defn,a=i.length,c=new Array(a),l=0;l<a;++l)c[l]=o(i[l]);var u=r.apply(null,c);if(void 0===u)throw"module ["+e+"] returned undefined";n.instance=u},n=function(e,n,o){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===o)throw"no definition function for "+e;t[e]={deps:n,defn:o,instance:void 0}},o=function(n){var o=t[n];if(void 0===o)throw"module ["+n+"] was undefined";return void 0===o.instance&&e(n),o.instance},i=function(t,e){for(var n=t.length,i=new Array(n),r=0;r<n;++r)i.push(o(t[r]));e.apply(null,e)};({}).bolt={module:{api:{define:n,require:i,demand:o}}};var r=n,a=function(t,e){r(t,[],function(){return e})};a("global!tinymce.PluginManager",tinymce.PluginManager),a("global!tinymce.Env",tinymce.Env),a("global!tinymce.util.Promise",tinymce.util.Promise),a("global!tinymce.util.URI",tinymce.util.URI),a("global!tinymce.util.Tools",tinymce.util.Tools),a("global!tinymce.util.Delay",tinymce.util.Delay),r("ephox/imagetools/util/Canvas",[],function(){function t(t,e){return o(document.createElement("canvas"),t,e)}function e(t){return t.getContext("2d")}function n(t){var e=null;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){}return e||(e=null),e}function o(t,e,n){return t.width=e,t.height=n,t}return{create:t,resize:o,get2dContext:e,get3dContext:n}}),r("ephox/imagetools/util/ImageSize",[],function(){function t(t){return t.naturalWidth||t.width}function e(t){return t.naturalHeight||t.height}return{getWidth:t,getHeight:e}}),r("ephox/imagetools/util/Promise",[],function(){function t(t,e){return function(){t.apply(e,arguments)}}function e(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(e,t(o,this),t(i,this))}function n(t){var e=this;null!==this._state?l(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null!==n){var o;try{o=n(e._value)}catch(e){return void t.reject(e)}t.resolve(o)}else(e._state?t.resolve:t.reject)(e._value)}):this._deferreds.push(t)}function o(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void c(t(n,e),t(o,this),t(i,this))}this._state=!0,this._value=e,r.call(this)}catch(t){i.call(this,t)}}function i(t){this._state=!1,this._value=t,r.call(this)}function r(){for(var t=0,e=this._deferreds.length;t<e;t++)n.call(this,this._deferreds[t]);this._deferreds=null}function a(t,e,n,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=o}function c(t,e,n){var o=!1;try{t(function(t){o||(o=!0,e(t))},function(t){o||(o=!0,n(t))})}catch(t){if(o)return;o=!0,n(t)}}if(window.Promise)return window.Promise;var l=e.immediateFn||"function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)},u=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.then=function(t,o){var i=this;return new e(function(e,r){n.call(i,new a(t,o,e,r))})},e.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&u(arguments[0])?arguments[0]:arguments);return new e(function(e,n){function o(r,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(t){o(r,t)},n)}t[r]=a,0==--i&&e(t)}catch(t){n(t)}}if(0===t.length)return e([]);for(var i=t.length,r=0;r<t.length;r++)o(r,t[r])})},e.resolve=function(t){return t&&"object"==typeof t&&t.constructor===e?t:new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var o=0,i=t.length;o<i;o++)t[o].then(e,n)})},e}),r("ephox/imagetools/util/Mime",[],function(){function t(t){var e=document.createElement("a");return e.href=t,e.pathname}function e(e){var n=t(e).split("."),o=n[n.length-1],i={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return o&&(o=o.toLowerCase()),i[o]}return{guessMimeType:e}}),r("ephox/imagetools/util/Conversions",["ephox/imagetools/util/Promise","ephox/imagetools/util/Canvas","ephox/imagetools/util/Mime","ephox/imagetools/util/ImageSize"],function(t,e,n,o){function i(e){return new t(function(t){function n(){e.removeEventListener("load",n),t(e)}e.complete?t(e):e.addEventListener("load",n)})}function r(t){return i(t).then(function(t){var n;return n=e.create(o.getWidth(t),o.getHeight(t)),e.get2dContext(n).drawImage(t,0,0),n})}function a(t){return i(t).then(function(t){var e=t.src;return 0===e.indexOf("blob:")?l(e):0===e.indexOf("data:")?u(e):r(t).then(function(t){return u(t.toDataURL(n.guessMimeType(e)))})})}function c(e){return new t(function(t){function n(){o.removeEventListener("load",n),t(o)}var o=new Image;o.addEventListener("load",n),o.src=URL.createObjectURL(e),o.complete&&n()})}function l(e){return new t(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){200==this.status&&t(this.response)},n.send()})}function u(e){return new t(function(t){var n,o,i,r,a,c;if(e=e.split(","),(r=/data:([^;]+)/.exec(e[0]))&&(a=r[1]),n=atob(e[1]),window.WebKitBlobBuilder){for(c=new WebKitBlobBuilder,o=new ArrayBuffer(n.length),i=0;i<o.length;i++)o[i]=n.charCodeAt(i);return c.append(o),void t(c.getBlob(a))}for(o=new Uint8Array(n.length),i=0;i<o.length;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:a}))})}function s(t){return 0===t.indexOf("blob:")?l(t):0===t.indexOf("data:")?u(t):null}function f(t,e){return u(t.toDataURL(e))}function m(e){return new t(function(t){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})}function g(t){return m(t).then(function(t){return t.split(",")[1]})}function d(t){URL.revokeObjectURL(t.src)}return{blobToImage:c,imageToBlob:a,blobToDataUri:m,blobToBase64:g,imageToCanvas:r,canvasToBlob:f,revokeImageUrl:d,uriToBlob:s}}),r("ephox/imagetools/transformations/ColorMatrix",[],function(){function t(t,e,n){return t=parseFloat(t),t>n?t=n:t<e&&(t=e),t}function e(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function n(t,e){var n,o,i,r,a=[],c=new Array(10);for(n=0;n<5;n++){for(o=0;o<5;o++)a[o]=e[o+5*n];for(o=0;o<5;o++){for(r=0,i=0;i<5;i++)r+=t[o+5*i]*a[i];c[o+5*n]=r}}return c}function o(e,n){return n=t(n,0,1),e.map(function(e,o){return o%6==0?e=1-(1-e)*n:e*=n,t(e,0,1)})}function i(e,o){var i;return o=t(o,-1,1),o*=100,i=o<0?127+o/100*127:127*(i=0===(i=o%1)?f[o]:f[Math.floor(o)]*(1-i)+f[Math.floor(o)+1]*i)+127,n(e,[i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1])}function r(e,o){var i;return o=t(o,-1,1),i=1+(o>0?3*o:o),.3086,.6094,.082,n(e,[.3086*(1-i)+i,.6094*(1-i),.082*(1-i),0,0,.3086*(1-i),.6094*(1-i)+i,.082*(1-i),0,0,.3086*(1-i),.6094*(1-i),.082*(1-i)+i,0,0,0,0,0,1,0,0,0,0,0,1])}function a(e,o){var i,r;return o=t(o,-180,180)/180*Math.PI,i=Math.cos(o),r=Math.sin(o),.213,.715,.072,n(e,[.213+.787*i+-.213*r,.715+-.715*i+-.715*r,.072+-.072*i+.928*r,0,0,.213+-.213*i+.143*r,.715+i*(1-.715)+.14*r,.072+-.072*i+-.283*r,0,0,.213+-.213*i+-.787*r,.715+-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,0,1,0,0,0,0,0,1])}function c(e,o){return o=t(255*o,-255,255),n(e,[1,0,0,0,o,0,1,0,0,o,0,0,1,0,o,0,0,0,1,0,0,0,0,0,1])}function l(e,o,i,r){return o=t(o,0,2),i=t(i,0,2),r=t(r,0,2),n(e,[o,0,0,0,0,0,i,0,0,0,0,0,r,0,0,0,0,0,1,0,0,0,0,0,1])}function u(e,i){return i=t(i,0,1),n(e,o([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],i))}function s(e,i){return i=t(i,0,1),n(e,o([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],i))}var f=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:e,adjust:o,multiply:n,adjustContrast:i,adjustBrightness:c,adjustSaturation:r,adjustHue:a,adjustColors:l,adjustSepia:u,adjustGrayscale:s}}),r("ephox/imagetools/transformations/Filters",["ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/util/Conversions","ephox/imagetools/transformations/ColorMatrix"],function(t,e,n,o){function i(o,i){return n.blobToImage(o).then(function(o){var r,a=t.create(e.getWidth(o),e.getHeight(o)),c=t.get2dContext(a);return c.drawImage(o,0,0),u(o),r=function(t,e){var n,o,i,r,a,c=t.data,l=e[0],u=e[1],s=e[2],f=e[3],m=e[4],g=e[5],d=e[6],h=e[7],p=e[8],y=e[9],b=e[10],v=e[11],w=e[12],x=e[13],I=e[14],R=e[15],C=e[16],k=e[17],T=e[18],M=e[19];for(a=0;a<c.length;a+=4)n=c[a],o=c[a+1],i=c[a+2],r=c[a+3],c[a]=n*l+o*u+i*s+r*f+m,c[a+1]=n*g+o*d+i*h+r*p+y,c[a+2]=n*b+o*v+i*w+r*x+I,c[a+3]=n*R+o*C+i*k+r*T+M;return t}(c.getImageData(0,0,a.width,a.height),i),c.putImageData(r,0,0),n.canvasToBlob(a)})}function r(o,i){return n.blobToImage(o).then(function(o){var r,a,c=t.create(e.getWidth(o),e.getHeight(o)),l=t.get2dContext(c);return l.drawImage(o,0,0),u(o),r=l.getImageData(0,0,c.width,c.height),a=l.getImageData(0,0,c.width,c.height),a=function(t,e,n){function o(t,e,n){return t>n?t=n:t<e&&(t=e),t}var i,r,a,c,l,u,s,f,m,g,d,h,p,y,b,v;for(a=Math.round(Math.sqrt(n.length)),c=Math.floor(a/2),i=t.data,r=e.data,b=t.width,v=t.height,u=0;u<v;u++)for(l=0;l<b;l++){for(s=f=m=0,d=0;d<a;d++)for(g=0;g<a;g++)h=o(l+g-c,0,b-1),p=4*(o(u+d-c,0,v-1)*b+h),y=n[d*a+g],s+=i[p]*y,f+=i[p+1]*y,m+=i[p+2]*y;r[p=4*(u*b+l)]=o(s,0,255),r[p+1]=o(f,0,255),r[p+2]=o(m,0,255)}return e}(r,a,i),l.putImageData(a,0,0),n.canvasToBlob(c)})}function a(o){return function(i,r){return n.blobToImage(i).then(function(i){var a,c,l=t.create(e.getWidth(i),e.getHeight(i)),s=t.get2dContext(l),f=new Array(256);for(c=0;c<f.length;c++)f[c]=o(c,r);return s.drawImage(i,0,0),u(i),a=function(t,e){var n,o=t.data;for(n=0;n<o.length;n+=4)o[n]=e[o[n]],o[n+1]=e[o[n+1]],o[n+2]=e[o[n+2]];return t}(s.getImageData(0,0,l.width,l.height),f),s.putImageData(a,0,0),n.canvasToBlob(l)})}}function c(t){return function(e,n){return i(e,t(o.identity(),n))}}function l(t){return function(e){return r(e,t)}}var u=n.revokeImageUrl;return{invert:function(t){return function(e){return i(e,t)}}([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:c(o.adjustBrightness),hue:c(o.adjustHue),saturate:c(o.adjustSaturation),contrast:c(o.adjustContrast),grayscale:c(o.adjustGrayscale),sepia:c(o.adjustSepia),colorize:function(t,e,n,r){return i(t,o.adjustColors(o.identity(),e,n,r))},sharpen:l([0,-1,0,-1,5,-1,0,-1,0]),emboss:l([-2,-1,0,-1,1,1,0,1,2]),gamma:a(function(t,e){return 255*Math.pow(t/255,1-e)}),exposure:a(function(t,e){return 255*(1-Math.exp(-t/255*e))}),colorFilter:i,convoluteFilter:r}}),r("ephox/imagetools/transformations/ImageResizerCanvas",["ephox/imagetools/util/Promise","ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize"],function(t,e,n,o){function i(t,e,n){var a=o.getWidth(t),c=o.getHeight(t),l=e/a,u=n/c,s=!1;(l<.5||l>2)&&(l=l<.5?.5:2,s=!0),(u<.5||u>2)&&(u=u<.5?.5:2,s=!0);var f=r(t,l,u);return s?f.then(function(t){return i(t,e,n)}):f}function r(e,i,r){return new t(function(t){var a=o.getWidth(e),c=o.getHeight(e),l=Math.floor(a*i),u=Math.floor(c*r),s=n.create(l,u);n.get2dContext(s).drawImage(e,0,0,a,c,0,0,l,u),t(s)})}return{scale:i}}),r("ephox/imagetools/transformations/ImageTools",["ephox/imagetools/util/Conversions","ephox/imagetools/util/Canvas","ephox/imagetools/util/ImageSize","ephox/imagetools/transformations/ImageResizerCanvas"],function(t,e,n,o){function i(o,i){return t.blobToImage(o).then(function(r){var a=e.create(n.getWidth(r),n.getHeight(r)),c=e.get2dContext(a),u=0,s=0;return 90!=(i=i<0?360+i:i)&&270!=i||e.resize(a,a.height,a.width),90!=i&&180!=i||(u=a.width),270!=i&&180!=i||(s=a.height),c.translate(u,s),c.rotate(i*Math.PI/180),c.drawImage(r,0,0),l(r),t.canvasToBlob(a,o.type)})}function r(o,i){return t.blobToImage(o).then(function(o){var r=e.create(n.getWidth(o),n.getHeight(o)),a=e.get2dContext(r);return"v"==i?(a.scale(1,-1),a.drawImage(o,0,-r.height)):(a.scale(-1,1),a.drawImage(o,-r.width,0)),l(o),t.canvasToBlob(r)})}function a(n,o,i,r,a){return t.blobToImage(n).then(function(n){var c=e.create(r,a);return e.get2dContext(c).drawImage(n,-o,-i),l(n),t.canvasToBlob(c)})}function c(e,n,i){return t.blobToImage(e).then(function(r){return o.scale(r,n,i).then(function(n){return t.canvasToBlob(n,e.type)}).then(u(r)).catch(u(r))})}var l=t.revokeImageUrl,u=function(t){return function(e){return l(t),e}};return{rotate:i,flip:r,crop:a,resize:c}}),r("ephox/imagetools/api/ImageTransformations",["ephox/imagetools/transformations/Filters","ephox/imagetools/transformations/ImageTools"],function(t,e){return{invert:function(e){return t.invert(e)},sharpen:function(e){return t.sharpen(e)},emboss:function(e){return t.emboss(e)},brightness:function(e,n){return t.brightness(e,n)},hue:function(e,n){return t.hue(e,n)},saturate:function(e,n){return t.saturate(e,n)},contrast:function(e,n){return t.contrast(e,n)},grayscale:function(e,n){return t.grayscale(e,n)},sepia:function(e,n){return t.sepia(e,n)},colorize:function(e,n,o,i){return t.colorize(e,n,o,i)},gamma:function(e,n){return t.gamma(e,n)},exposure:function(e,n){return t.exposure(e,n)},flip:function(t,n){return e.flip(t,n)},crop:function(t,n,o,i,r){return e.crop(t,n,o,i,r)},resize:function(t,n,o){return e.resize(t,n,o)},rotate:function(t,n){return e.rotate(t,n)}}}),r("ephox/imagetools/api/BlobConversions",["ephox/imagetools/util/Conversions"],function(t){return{blobToImage:function(e){return t.blobToImage(e)},imageToBlob:function(e){return t.imageToBlob(e)},blobToDataUri:function(e){return t.blobToDataUri(e)},blobToBase64:function(e){return t.blobToBase64(e)}}}),a("global!tinymce.dom.DOMUtils",tinymce.dom.DOMUtils),a("global!tinymce.ui.Factory",tinymce.ui.Factory),a("global!tinymce.ui.Form",tinymce.ui.Form),a("global!tinymce.ui.Container",tinymce.ui.Container),a("global!tinymce.ui.Control",tinymce.ui.Control),a("global!tinymce.ui.DragHelper",tinymce.ui.DragHelper),a("global!tinymce.geom.Rect",tinymce.geom.Rect),a("global!tinymce.dom.DomQuery",tinymce.dom.DomQuery),a("global!tinymce.util.Observable",tinymce.util.Observable),a("global!tinymce.util.VK",tinymce.util.VK),r("tinymce/imagetoolsplugin/CropRect",["global!tinymce.dom.DomQuery","global!tinymce.ui.DragHelper","global!tinymce.geom.Rect","global!tinymce.util.Tools","global!tinymce.util.Observable","global!tinymce.util.VK"],function(t,e,n,o,i,r){var a=0;return function(c,l,u,s,f){function m(t,e){return{x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}}function g(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function d(){return g(u,c)}function h(t,e,o,i){var r,a,l,s,f;r=e.x,a=e.y,l=e.w,s=e.h,r+=o*t.deltaX,a+=i*t.deltaY,l+=o*t.deltaW,s+=i*t.deltaH,l<20&&(l=20),s<20&&(s=20),f=c=n.clamp({x:r,y:a,w:l,h:s},u,"move"==t.name),f=g(u,f),R.fire("updateRect",{rect:f}),w(f)}function p(e){var n;n=o.map(C,function(t){return"#"+z+"-"+t.name}).concat(o.map(T,function(t){return"#"+z+"-"+t})).join(","),e?t(n,s).show():t(n,s).hide()}function y(e){function n(e,n){n.h<0&&(n.h=0),n.w<0&&(n.w=0),t("#"+z+"-"+e,s).css({left:n.x,top:n.y,width:n.w,height:n.h})}o.each(C,function(n){t("#"+z+"-"+n.name,s).css({left:e.w*n.xMul+e.x,top:e.h*n.yMul+e.y})}),n("top",{x:l.x,y:l.y,w:l.w,h:e.y-l.y}),n("right",{x:e.x+e.w,y:e.y,w:l.w-e.x-e.w+l.x,h:e.h}),n("bottom",{x:l.x,y:e.y+e.h,w:l.w,h:l.h-e.y-e.h+l.y}),n("left",{x:l.x,y:e.y,w:e.x-l.x,h:e.h}),n("move",e)}function b(t){y(c=t)}function v(t){l=t,y(c)}function w(t){b(m(u,t))}function x(t){u=t,y(c)}function I(){o.each(k,function(t){t.destroy()}),k=[]}var R,C,k,T,M="mce-",z=M+"crid-"+a++;return C=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],T=["top","right","bottom","left"],function(){function n(t){var n;return new e(z,{document:s.ownerDocument,handle:z+"-"+t.name,start:function(){n=c},drag:function(e){h(t,n,e.deltaX,e.deltaY)}})}t('<div id="'+z+'" class="'+M+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(s),o.each(T,function(e){t("#"+z,s).append('<div id="'+z+"-"+e+'"class="'+M+'croprect-block" style="display: none" data-mce-bogus="all">')}),o.each(C,function(e){t("#"+z,s).append('<div id="'+z+"-"+e.name+'" class="'+M+"croprect-handle "+M+"croprect-handle-"+e.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+e.label+'" aria-grabbed="false">')}),k=o.map(C,n),y(c),t(s).on("focusin focusout",function(e){t(e.target).attr("aria-grabbed","focus"===e.type)}),t(s).on("keydown",function(t){function e(t,e,o,i,r){t.stopPropagation(),t.preventDefault(),h(n,o,i,r)}var n;switch(o.each(C,function(e){if(t.target.id==z+"-"+e.name)return n=e,!1}),t.keyCode){case r.LEFT:e(t,n,c,-10,0);break;case r.RIGHT:e(t,n,c,10,0);break;case r.UP:e(t,n,c,0,-10);break;case r.DOWN:e(t,n,c,0,10);break;case r.ENTER:case r.SPACEBAR:t.preventDefault(),f()}})}(),R=o.extend({toggleVisibility:p,setClampRect:x,setRect:b,getInnerRect:d,setInnerRect:w,setViewPortRect:v,destroy:I},i)}}),r("tinymce/imagetoolsplugin/ImagePanel",["global!tinymce.ui.Control","global!tinymce.ui.DragHelper","global!tinymce.geom.Rect","global!tinymce.util.Tools","global!tinymce.util.Promise","tinymce/imagetoolsplugin/CropRect"],function(t,e,n,o,i,r){function a(t){return new i(function(e){function n(){t.removeEventListener("load",n),e(t)}t.complete?e(t):t.addEventListener("load",n)})}return t.extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(t){var e=this,o=new Image;o.src=t,a(o).then(function(){var t,i,r=e.state.get("viewRect");if((i=e.$el.find("img"))[0])i.replaceWith(o);else{var a=document.createElement("div");a.className="mce-imagepanel-bg",e.getEl().appendChild(a),e.getEl().appendChild(o)}t={x:0,y:0,w:o.naturalWidth,h:o.naturalHeight},e.state.set("viewRect",t),e.state.set("rect",n.inflate(t,-20,-20)),r&&r.w==t.w&&r.h==t.h||e.zoomFit(),e.repaintImage(),e.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,o,i,r,a=this;t=a.$el.find("img"),e=a.getEl().clientWidth,n=a.getEl().clientHeight,o=t[0].naturalWidth,i=t[0].naturalHeight,(r=Math.min((e-10)/o,(n-10)/i))>=1&&(r=1),a.zoom(r)},repaintImage:function(){var t,e,n,o,i,r,a,c,l,u,s;s=this.getEl(),l=this.zoom(),u=this.state.get("rect"),a=this.$el.find("img"),c=this.$el.find(".mce-imagepanel-bg"),i=s.offsetWidth,r=s.offsetHeight,n=a[0].naturalWidth*l,o=a[0].naturalHeight*l,t=Math.max(0,i/2-n/2),e=Math.max(0,r/2-o/2),a.css({left:t,top:e,width:n,height:o}),c.css({left:t,top:e,width:n,height:o}),this.cropRect&&(this.cropRect.setRect({x:u.x*l+t,y:u.y*l+e,w:u.w*l,h:u.h*l}),this.cropRect.setClampRect({x:t,y:e,w:n,h:o}),this.cropRect.setViewPortRect({x:0,y:0,w:i,h:r}))},bindStates:function(){function t(t){e.cropRect=new r(t,e.state.get("viewRect"),e.state.get("viewRect"),e.getEl(),function(){e.fire("crop")}),e.cropRect.on("updateRect",function(t){var n=t.rect,o=e.zoom();n={x:Math.round(n.x/o),y:Math.round(n.y/o),w:Math.round(n.w/o),h:Math.round(n.h/o)},e.state.set("rect",n)}),e.on("remove",e.cropRect.destroy)}var e=this;e.state.on("change:cropEnabled",function(t){e.cropRect.toggleVisibility(t.value),e.repaintImage()}),e.state.on("change:zoom",function(){e.repaintImage()}),e.state.on("change:rect",function(n){var o=n.value;e.cropRect||t(o),e.cropRect.setRect(o)})}})}),r("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){function t(t){var e;return e=r.splice(++a),r.push(t),{state:t,removed:e}}function e(){if(o())return r[--a]}function n(){if(i())return r[++a]}function o(){return a>0}function i(){return-1!=a&&a<r.length-1}var r=[],a=-1;return{data:r,add:t,undo:e,redo:n,canUndo:o,canRedo:i}}}),r("tinymce/imagetoolsplugin/Dialog",["global!tinymce.dom.DOMUtils","global!tinymce.util.Tools","global!tinymce.util.Promise","global!tinymce.ui.Factory","global!tinymce.ui.Form","global!tinymce.ui.Container","tinymce/imagetoolsplugin/ImagePanel","ephox/imagetools/api/ImageTransformations","ephox/imagetools/api/BlobConversions","tinymce/imagetoolsplugin/UndoStack"],function(t,e,n,o,i,r,a,c,l,u){function s(t){return{blob:t,url:URL.createObjectURL(t)}}function f(t){t&&URL.revokeObjectURL(t.url)}function m(t){e.each(t,f)}function g(n,l,g){function d(t){var e,n,o,i;e=A.find("#w")[0],n=A.find("#h")[0],o=parseInt(e.value(),10),i=parseInt(n.value(),10),A.find("#constrain")[0].checked()&&rt&&at&&o&&i&&("w"==t.control.settings.name?(i=Math.round(o*ct),n.value(i)):(o=Math.round(i*lt),e.value(o))),rt=o,at=i}function h(t){return Math.round(100*t)+"%"}function p(){A.find("#undo").disabled(!ut.canUndo()),A.find("#redo").disabled(!ut.canRedo()),A.statusbar.find("#save").disabled(!ut.canUndo())}function y(){A.find("#undo").disabled(!0),A.find("#redo").disabled(!0)}function b(t){t&&V.imageSrc(t.url)}function v(t){return function(){var n=e.grep(it,function(e){return e.settings.name!=t});e.each(n,function(t){t.hide()}),t.show(),t.focus()}}function w(t){b(_=s(t))}function x(t){b(n=s(t)),m(ut.add(n).removed),p()}function I(){var t=V.selection();c.crop(n.blob,t.x,t.y,t.w,t.h).then(function(t){x(t),k()})}function R(t){var e=[].slice.call(arguments,1);return function(){var o=_||n;t.apply(this,[o.blob].concat(e)).then(w)}}function C(t){var e=[].slice.call(arguments,1);return function(){t.apply(this,[n.blob].concat(e)).then(x)}}function k(){b(n),f(_),v(P)(),p()}function T(){_&&(x(_.blob),k())}function M(){var t=V.zoom();t<2&&(t+=.1),V.zoom(t)}function z(){var t=V.zoom();t>.1&&(t-=.1),V.zoom(t)}function B(){b(n=ut.undo()),p()}function U(){b(n=ut.redo()),p()}function j(){l(n.blob),A.close()}function H(t){return new i({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function S(t,e){return H([{text:"Back",onclick:k},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){y(),e(n.blob).then(function(t){var e=s(t);b(e),f(_),_=e})})}function D(t,e,o,i,r){function a(t){e(n.blob,t).then(function(t){var e=s(t);b(e),f(_),_=e})}return H([{text:"Back",onclick:k},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){a(t.value)},minValue:i,maxValue:r,value:o,previewFilter:h},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){this.find("slider").value(o),y()})}function E(t){!0===t.control.value()&&(ct=at/rt,lt=rt/at)}var A,P,F,_,W,L,O,V,G,N,X,$,q,Y,K,J,Q,Z,tt,et,nt,ot,it,rt,at,ct,lt,ut=new u;W=H([{text:"Back",onclick:k},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:I}]).hide().on("show hide",function(t){V.toggleCropRect("show"==t.type)}).on("show",y),L=H([{text:"Back",onclick:k},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:d},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:d},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:E},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(t){var e=parseInt(A.find("#w").value(),10),n=parseInt(A.find("#h").value(),10);t.preventDefault(),C(c.resize,e,n)(),k()}).on("show",y),O=H([{text:"Back",onclick:k},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:R(c.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:R(c.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:R(c.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:R(c.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",y),X=S("Invert",c.invert),tt=S("Sharpen",c.sharpen),et=S("Emboss",c.emboss),$=D("Brightness",c.brightness,0,-1,1),q=D("Hue",c.hue,180,0,360),Y=D("Saturate",c.saturate,0,-1,1),K=D("Contrast",c.contrast,0,-1,1),J=D("Grayscale",c.grayscale,0,0,1),Q=D("Sepia",c.sepia,0,0,1),Z=function(t,e){function o(){var t,o,i;t=A.find("#r")[0].value(),o=A.find("#g")[0].value(),i=A.find("#b")[0].value(),e(n.blob,t,o,i).then(function(t){var e=s(t);b(e),f(_),_=e})}return H([{text:"Back",onclick:k},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:h},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:h},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:h},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){A.find("#r,#g,#b").value(1),y()})}("Colorize",c.colorize),nt=D("Gamma",c.gamma,0,-1,1),ot=D("Exposure",c.exposure,1,0,2),F=H([{text:"Back",onclick:k},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:v(q)},{text:"saturate",icon:"saturate",onclick:v(Y)},{text:"sepia",icon:"sepia",onclick:v(Q)},{text:"emboss",icon:"emboss",onclick:v(et)},{text:"exposure",icon:"exposure",onclick:v(ot)},{type:"spacer",flex:1}]).hide(),P=H([{tooltip:"Crop",icon:"crop",onclick:v(W)},{tooltip:"Resize",icon:"resize2",onclick:v(L)},{tooltip:"Orientation",icon:"orientation",onclick:v(O)},{tooltip:"Brightness",icon:"sun",onclick:v($)},{tooltip:"Sharpen",icon:"sharpen",onclick:v(tt)},{tooltip:"Contrast",icon:"contrast",onclick:v(K)},{tooltip:"Color levels",icon:"drop",onclick:v(Z)},{tooltip:"Gamma",icon:"gamma",onclick:v(nt)},{tooltip:"Invert",icon:"invert",onclick:v(X)}]),V=new a({flex:1,imageSrc:n.url}),G=new r({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:B},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:U},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:M},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:z}]}),N=new r({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[G,V]}),it=[P,W,L,O,F,X,$,q,Y,K,J,Q,Z,tt,et,nt,ot],(A=o.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(t.DOM.getViewPort().w,800),minHeight:Math.min(t.DOM.getViewPort().h,650),title:"Edit image",items:it.concat([N]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:j},{text:"Cancel",onclick:"close"}]})).renderTo(document.body).reflow(),A.on("close",function(){g(),m(ut.data),ut=null,_=null}),ut.add(n),p(),V.on("load",function(){rt=V.imageSize().w,at=V.imageSize().h,ct=at/rt,lt=rt/at,A.find("#w").value(rt),A.find("#h").value(at)}),V.on("crop",I)}function d(t){return new n(function(e,n){g(s(t),e,n)})}return{edit:d}}),r("tinymce/imagetoolsplugin/ImageSize",[],function(){function t(t){function e(t){return/^[0-9\.]+px$/.test(t)}var n,o;return n=t.style.width,o=t.style.height,n||o?e(n)&&e(o)?{w:parseInt(n,10),h:parseInt(o,10)}:null:(n=t.width,o=t.height,n&&o?{w:parseInt(n,10),h:parseInt(o,10)}:null)}function e(t,e){var n,o;e&&(n=t.style.width,o=t.style.height,(n||o)&&(t.style.width=e.w+"px",t.style.height=e.h+"px",t.removeAttribute("data-mce-style")),n=t.width,o=t.height,(n||o)&&(t.setAttribute("width",e.w),t.setAttribute("height",e.h)))}function n(t){return{w:t.naturalWidth,h:t.naturalHeight}}return{getImageSize:t,setImageSize:e,getNaturalImageSize:n}}),r("tinymce/imagetoolsplugin/Utils",["global!tinymce.util.Promise","global!tinymce.util.Tools"],function(t,e){var n=function(t){return null!==t&&void 0!==t};return{traverse:function(t,e){var o;return o=e.reduce(function(t,e){return n(t)?t[e]:void 0},t),n(o)?o:null},readBlob:function(e){return new t(function(t){var n=new FileReader;n.onload=function(e){var n=e.target;t(n.result)},n.readAsText(e)})},requestUrlAsBlob:function(n,o){return new t(function(t){var i;(i=new XMLHttpRequest).onreadystatechange=function(){4===i.readyState&&t({status:i.status,blob:this.response})},i.open("GET",n,!0),e.each(o,function(t,e){i.setRequestHeader(e,t)}),i.responseType="blob",i.send()})},parseJson:function(t){var e;try{e=JSON.parse(t)}catch(t){}return e}}}),r("tinymce/imagetoolsplugin/Proxy",["global!tinymce.util.Promise","global!tinymce.util.Tools","tinymce/imagetoolsplugin/Utils"],function(t,e,n){function o(e){return n.requestUrlAsBlob(e,{}).then(function(e){return e.status>=400?r(e.status):t.resolve(e.blob)})}var i=function(t){return 400===t||403===t||500===t},r=function(e){return t.reject("ImageProxy HTTP error: "+e)},a=function(e){t.reject("ImageProxy Service error: "+e)},c=function(t,e){return n.readBlob(e).then(function(t){var e=n.parseJson(t),o=n.traverse(e,["error","type"]);return a(o?o:"Invalid JSON")})},l=function(t,e){return i(t)?c(0,e):r(t)},u=function(e,o){return n.requestUrlAsBlob(e,{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":o}).then(function(e){return e.status>=400?l(e.status,e.blob):t.resolve(e.blob)})};return{getUrl:function(t,e){return e?u(t,e):o(t)}}}),r("tinymce/imagetoolsplugin/Plugin",["global!tinymce.PluginManager","global!tinymce.Env","global!tinymce.util.Promise","global!tinymce.util.URI","global!tinymce.util.Tools","global!tinymce.util.Delay","ephox/imagetools/api/ImageTransformations","ephox/imagetools/api/BlobConversions","tinymce/imagetoolsplugin/Dialog","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Proxy"],function(t,e,n,o,i,r,a,c,l,u,s){var f=function(t){function f(e){t.notificationManager.open({text:e,type:"error"})}function m(){return t.selection.getNode()}function g(e){var n=e.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return n?t.dom.encode(n[1]):null}function d(){return"imagetools"+U++}function h(e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new o(n).host===t.documentBaseURI.host}function p(e){return-1!==i.inArray(t.settings.imagetools_cors_hosts,new o(e.src).host)}function y(){return t.settings.api_key||t.settings.imagetools_api_key}function b(e){var n,o=e.src;return p(e)?s.getUrl(e.src,null):h(e)?c.imageToBlob(e):(o=t.settings.imagetools_proxy,o+=(-1===o.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),n=y(),s.getUrl(o,n))}function v(){var e;return e=t.editorUpload.blobCache.getByUri(m().src),e?e.blob():b(m())}function w(){z=r.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},t.settings.images_upload_timeout||3e4)}function x(){clearTimeout(z)}function I(e,n){return c.blobToDataUri(e).then(function(i){var r,a,c,l,u,s;return s=m(),l=t.editorUpload.blobCache,u=l.getByUri(s.src),c=o.parseDataUri(i).data,r=d(),t.settings.images_reuse_filename&&(a=u?u.filename():g(s.src)),u=l.create(r,e,c,a),l.add(u),t.undoManager.transact(function(){function e(){t.$(s).off("load",e),t.nodeChanged(),n?t.editorUpload.uploadImagesAuto():(x(),w())}t.$(s).on("load",e),t.$(s).attr({src:u.blobUri()}).removeAttr("data-mce-src")}),u})}function R(e){return function(){return t._scanForImages().then(v).then(e).then(I,f)}}function C(t){return function(){return R(function(e){var n=u.getImageSize(m());return n&&u.setImageSize(m(),{w:n.h,h:n.w}),a.rotate(e,t)})()}}function k(t){return function(){return R(function(e){return a.flip(e,t)})()}}function T(){var t=m(),e=u.getNaturalImageSize(t),o=function(o){return new n(function(n){c.blobToImage(o).then(function(i){var r=u.getNaturalImageSize(i);e.w==r.w&&e.h==r.h||u.getImageSize(t)&&u.setImageSize(t,r),URL.revokeObjectURL(i.src),n(o)})})},i=function(t){return l.edit(t).then(o).then(function(t){I(t,!0)},function(){})};t&&b(t).then(i,f)}function M(e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")&&(h(e)||p(e)||t.settings.imagetools_proxy)}var z,B,U=0;e.fileApi&&(i.each({mceImageRotateLeft:C(-90),mceImageRotateRight:C(90),mceImageFlipVertical:k("v"),mceImageFlipHorizontal:k("h"),mceEditImage:T},function(e,n){t.addCommand(n,e)}),function(){t.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),t.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),t.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),t.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),t.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}(),function(){var e=t.settings.imagetools_toolbar;e||(e="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),t.addContextToolbar(M,e)}(),function(){t.on("NodeChange",function(e){B&&B.src!=e.element.src&&(x(),t.editorUpload.uploadImagesAuto(),B=void 0),M(e.element)&&(B=e.element)})}())};return t.add("imagetools",f),function(){}}),o("tinymce/imagetoolsplugin/Plugin")()}();